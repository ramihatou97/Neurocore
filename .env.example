#!/bin/bash
# ==================== Application ====================
APP_NAME=Neurosurgery Knowledge Base
export APP_VERSION=1.0.0
export DEBUG=false
export LOG_LEVEL=INFO

# ==================== Database ====================
export DB_HOST=postgres
export DB_PORT=5434
export DB_NAME=neurosurgery_kb
export DB_USER=nsurg_admin
export DB_PASSWORD=CHANGE_ME_SECURE_PASSWORD_HERE

# ==================== Redis Cache ====================
export REDIS_HOST=redis
export REDIS_PORT=6381
export REDIS_DB=0
export REDIS_MAX_CONNECTIONS=50
# REDIS_PASSWORD=optional_redis_password

# ==================== Resilience & Error Handling ====================

# Circuit Breaker: Prevents cascading failures by temporarily disabling failing AI providers
export CIRCUIT_BREAKER_FAILURE_THRESHOLD=5      # Number of failures before opening circuit
export CIRCUIT_BREAKER_FAILURE_WINDOW=60        # Time window for counting failures (seconds)
export CIRCUIT_BREAKER_RECOVERY_TIMEOUT=60      # Time before attempting recovery (seconds)
export CIRCUIT_BREAKER_HALF_OPEN_MAX_CALLS=3    # Test calls in half-open state

# Task Checkpoint: Enables resuming long-running tasks from last successful step
export TASK_CHECKPOINT_TTL=604800               # Checkpoint retention: 7 days in seconds
export TASK_CHECKPOINT_ENABLED=true             # Enable checkpoint recovery

# Dead Letter Queue: Captures permanently failed tasks for manual intervention
export DLQ_RETENTION_DAYS=30                    # Failed task retention period (days)
export DLQ_MAX_ENTRIES=10000                    # Maximum DLQ entries before cleanup
export DLQ_ENABLED=true                         # Enable dead letter queue

# ==================== Monitoring & Error Tracking (Phase 2) ====================

# Sentry Error Tracking (Optional - Production Recommended)
# Get your DSN from: https://sentry.io/settings/projects/
# Format: https://[public_key]@[org_id].ingest.sentry.io/[project_id]
# export SENTRY_DSN=https://xxx@oXXX.ingest.sentry.io/XXX
export SENTRY_ENVIRONMENT=production            # Environment name (development, staging, production)
export SENTRY_TRACES_SAMPLE_RATE=0.1            # Performance monitoring: 10% of transactions
export SENTRY_PROFILES_SAMPLE_RATE=0.1          # Profiling: 10% of transactions
export SENTRY_DEBUG=false                       # Enable Sentry SDK debug mode

# ==================== Authentication ====================
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
export JWT_SECRET=CHANGE_ME_GENERATE_RANDOM_256BIT_KEY
export JWT_ALGORITHM=HS256
export JWT_EXPIRY_HOURS=24

# ==================== AI Providers ====================

# OpenAI (required for embeddings and fallback)
export OPENAI_API_KEY=sk-...

# Anthropic Claude (primary synthesis provider)
export ANTHROPIC_API_KEY=sk-ant-...

# Google Gemini (primary research provider)
export GOOGLE_API_KEY=...

# ==================== External Research APIs ====================

# PubMed (optional but recommended)
export PUBMED_EMAIL=your_email@example.com
# PUBMED_API_KEY=optional_for_higher_rate_limits

# Google Scholar (via SerpAPI or similar)
# SCHOLAR_API_KEY=optional

# Perplexity AI (AI-first external research)
# Used for real-time web synthesis of neurosurgical expertise
# Get API key from: https://www.perplexity.ai/settings/api
export PERPLEXITY_API_KEY=pplx-...

# ==================== External Research Strategy (AI-First) ====================
# Controls dual-track external research: AI synthesis + Evidence databases

# Enable AI-powered research (Perplexity/Gemini) alongside PubMed
export EXTERNAL_RESEARCH_AI_ENABLED=true

# AI provider selection: "perplexity", "gemini_grounding" (Phase 2), "both"
export EXTERNAL_RESEARCH_AI_PROVIDER=perplexity

# Research execution strategy: "evidence_only" (PubMed only), "ai_only" (AI only), "hybrid" (both)
export EXTERNAL_RESEARCH_STRATEGY=hybrid

# Execute PubMed and AI research in parallel for speed (recommended)
export EXTERNAL_RESEARCH_PARALLEL_EXECUTION=true

# ==================== File Storage ====================
export PDF_STORAGE_PATH=/data/pdfs
export IMAGE_STORAGE_PATH=/data/images

# ==================== Server Ports (Isolated from DCS and System) ====================
# Port Allocation for Multi-Project Environment:
#   System PostgreSQL: 5432 (untouched - macOS system service)
#   DCS Project:       5433 (DB), 6380 (Redis), 3001 (Backend), 5173 (Frontend)
#   Neurocore:         5434 (DB), 6381 (Redis), 8002 (API), 3002 (Frontend), 5555 (Flower)
#
# IMPORTANT: Do NOT change these ports without verifying no conflicts with other projects
export API_PORT=8002
export FRONTEND_PORT=3002
export FLOWER_PORT=5555

# ==================== CORS Settings ====================
# Add your production domain when deploying
export API_URL=http://localhost:8002
export FRONTEND_URL=http://localhost:3002
# Production example:
# API_URL=https://api.neurosurgery-kb.com
# FRONTEND_URL=https://app.neurosurgery-kb.com

# ==================== Authentication ====================
# Authentication Control (false = enabled, true = disabled)
# IMPORTANT: Set to false in production for security
DISABLE_AUTH=false
